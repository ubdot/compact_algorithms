#include "erf.h"
double erf(double x){
    double t, s, r;
    t   = fabs(x);
    s   = x*x;
    if(t >= 1.0){
        double u;
        r   = fma(-5.6271698391213282e-18, t, 4.8565951797366214e-16);
        u   = fma(-1.9912968283386570e-14, t, 5.1614612434698227e-13);
        r   = fma(r, s, u);
        u   = fma(-9.4934693745934645e-12, t, 1.3183034417605052e-10);
        r   = fma(r, s, u);
        u   = fma(-1.4354030030292210e-09, t, 1.2558925114413972e-08);
        r   = fma(r, s, u);
        u   = fma(-8.9719702096303798e-08, t, 5.2832013824348913e-07);
        r   = fma(r, s, u);
        u   = fma(-2.5730580226082933e-06, t, 1.0322052949676148e-05);
        r   = fma(r, s, u);
        u   = fma(-3.3555264836700767e-05, t, 8.4667486930266041e-05);
        r   = fma(r, s, u);
        u   = fma(-1.4570926486271945e-04, t, 7.1877160107954648e-05);
        r   = fma(r, s, u);
        u   = fma(4.9486959714661590e-04, t, -1.6221099717135270e-03);
        r   = fma(r, s, u);
        u   = fma(1.6425707149019379e-04, t, 1.9148914196620660e-02);
        r   = fma(r, t, -1.0277918343487560e-1);
        r   = fma(r, t, -6.3661844223699315e-1);
        r   = fma(r, t, -1.2837929411398119e-1);
        r   = fma(r, t, -t);
        r   = 1.0 - exp(r);
        if(x < 0.0){
            r   = -r;
        }
    }else{
        r   = -7.7794684889591997e-10;
        r   = fma(r, s,  1.3710980398024347e-8);
        r   = fma(r, s, -1.6206313758492398e-7);
        r   = fma(r, s,  1.6447131571278227e-6);
        r   = fma(r, s, -1.4924712302009488e-5);
        r   = fma(r, s, 1.2055293576900605e-4);
        r   = fma(r, s, -8.5483259293144627e-4);
        r   = fma(r, s, 5.2239776061185055e-3);
        r   = fma(r, s, -2.6866170643111514e-2);
        r   = fma(r, s, 1.1283791670944182e-1);
        r   = fma(r, s, -3.7612638903183515e-1);
        r   = fma(r, s, 1.2837916709551256e-1);
        r   = fma(r, x, x);
    }
    return r;
}
double ierf(double y){
    double w, r, p;
    w   = -log(1.0-y*y);
    if(w < 5.0){
        w   = w - 2.500000;
        p   = 2.81022636e-08;
        p   = fma(p, w, 3.43273939e-07);
        p   = fma(p, w, -3.5233877e-06);
        p   = fma(p, w, -4.39150654e-06);
        p   = fma(p, w, 0.00021858087);
        p   = fma(p, w, -0.00125372503);
        p   = fma(p, w, -0.00417768164);
        p   = fma(p, w, 0.246640727);
        p   = fma(p, w, 1.50140941);
    }else{
        w   = sqrt(w) - 3.000000;
        p   = -0.000200214257;
        p   = fma(p, w, 0.000100950558);
        p   = fma(p, w, 0.00134934322);
        p   = fma(p, w, -0.00367342844);
        p   = fma(p, w, 0.00573950773);
        p   = fma(p, w, -0.0076224613);
        p   = fma(p, w, 0.00943887047);
        p   = fma(p, w, 1.00167406);
        p   = fma(p, w, 2.83297682);
    }
    r   = p * y;
    return r;
}
